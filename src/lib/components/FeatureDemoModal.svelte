<script>
  import { onMount } from 'svelte';
  
  let isOpen = false;
  
  export function open() {
    isOpen = true;
    if (typeof document !== 'undefined') {
      document.body.style.overflow = 'hidden';
    }
  }
  
  export function close() {
    isOpen = false;
    if (typeof document !== 'undefined') {
      document.body.style.overflow = '';
    }
  }
  
  const features = [
    {
      icon: 'M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2 M12 7a4 4 0 1 0 0 8 4 4 0 0 0 0-8z',
      title: 'Prontu√°rio Eletr√¥nico',
      description: 'Sistema completo de prontu√°rios digitais com seguran√ßa LGPD',
      fullDescription: 'Gerencie todo o hist√≥rico m√©dico dos seus pacientes de forma digital e segura. O prontu√°rio eletr√¥nico do UpClinic permite registrar consultas, exames, prescri√ß√µes e evolu√ß√µes cl√≠nicas com total conformidade √† LGPD. Acesso r√°pido, busca inteligente e backup autom√°tico garantem que todas as informa√ß√µes estejam sempre dispon√≠veis quando voc√™ precisar.',
      benefits: [
        'Hist√≥rico m√©dico completo e organizado',
        'Conformidade total com LGPD e normas do CFM',
        'Busca inteligente por sintomas, diagn√≥sticos ou medicamentos',
        'Anexos de exames e documentos',
        'Assinatura digital de prescri√ß√µes',
        'Backup autom√°tico na nuvem'
      ],
      color: 'blue',
      example: 'Exemplo: Um paciente retorna ap√≥s 6 meses. Com um clique, voc√™ acessa todo o hist√≥rico, exames anteriores, medica√ß√µes prescritas e evolu√ß√µes, permitindo um atendimento mais eficiente e preciso.'
    },
    {
      icon: 'M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2z',
      title: 'Agenda Inteligente',
      description: 'Agendamento autom√°tico com lembretes por WhatsApp e email',
      fullDescription: 'Transforme a gest√£o da sua agenda com intelig√™ncia artificial. O sistema sugere os melhores hor√°rios, envia lembretes autom√°ticos por WhatsApp e email, e otimiza sua agenda para maximizar a produtividade. Reduza faltas em at√© 80% com lembretes inteligentes e confirma√ß√µes autom√°ticas.',
      benefits: [
        'Agendamento online 24/7 para pacientes',
        'Lembretes autom√°ticos por WhatsApp, SMS e email',
        'Otimiza√ß√£o autom√°tica de hor√°rios',
        'Gest√£o de m√∫ltiplos profissionais e especialidades',
        'Bloqueio de hor√°rios e feriados',
        'Relat√≥rios de ocupa√ß√£o e produtividade'
      ],
      color: 'purple',
      example: 'Exemplo: Um paciente agenda uma consulta pelo site √†s 23h. O sistema confirma automaticamente, envia lembretes 48h e 24h antes, e 2h antes da consulta. Resultado: zero esquecimentos!'
    },
    {
      icon: 'M15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14M5 18h8a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2z',
      title: 'Telemedicina',
      description: 'Consultas online integradas com prescri√ß√£o digital',
      fullDescription: 'Realize consultas remotas com qualidade profissional. Videoconfer√™ncia HD, chat integrado, compartilhamento de tela para exames e prescri√ß√µes digitais assinadas eletronicamente. Tudo integrado ao prontu√°rio eletr√¥nico para um atendimento completo e documentado.',
      benefits: [
        'Videoconfer√™ncia HD com qualidade profissional',
        'Chat em tempo real durante a consulta',
        'Compartilhamento de tela para an√°lise de exames',
        'Grava√ß√£o de consultas (com consentimento do paciente)',
        'Prescri√ß√µes digitais com assinatura eletr√¥nica',
        'Integra√ß√£o completa com prontu√°rio eletr√¥nico'
      ],
      color: 'indigo',
      example: 'Exemplo: Paciente em outra cidade precisa de retorno. Voc√™ agenda uma teleconsulta, analisa exames compartilhando a tela, prescreve digitalmente e tudo fica registrado automaticamente no prontu√°rio.'
    },
    {
      icon: 'M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z',
      title: 'Gest√£o Financeira',
      description: 'Controle completo de receitas, despesas e pagamentos',
      fullDescription: 'Tenha controle total das finan√ßas da sua cl√≠nica. Receitas de consultas, despesas operacionais, controle de inadimpl√™ncia, relat√≥rios detalhados e integra√ß√£o com sistemas de pagamento. Tudo em um s√≥ lugar para voc√™ tomar decis√µes financeiras inteligentes.',
      benefits: [
        'Controle de receitas e despesas em tempo real',
        'Relat√≥rios financeiros detalhados e personalizados',
        'Gest√£o de inadimpl√™ncia e cobran√ßas',
        'Integra√ß√£o com gateways de pagamento',
        'An√°lise de lucratividade por profissional',
        'Previs√£o de fluxo de caixa'
      ],
      color: 'green',
      example: 'Exemplo: No final do m√™s, voc√™ acessa um dashboard completo mostrando receitas por especialidade, despesas categorizadas, taxa de inadimpl√™ncia e proje√ß√µes para o pr√≥ximo m√™s - tudo em gr√°ficos visuais.'
    },
    {
      icon: 'M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 1 1 7.072 0l-.548.547A3.374 3.374 0 0 1 14 18.469V19a2 2 0 1 1-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z',
      title: 'IA M√©dica',
      description: 'Assistente de IA para diagn√≥sticos e an√°lise de exames',
      fullDescription: 'Conte com intelig√™ncia artificial como seu assistente m√©dico. O sistema analisa sintomas, sugere diagn√≥sticos baseados em evid√™ncias cient√≠ficas, identifica padr√µes em exames e oferece suporte √† decis√£o cl√≠nica. Sempre como ferramenta de apoio, nunca substituindo o julgamento m√©dico.',
      benefits: [
        'An√°lise inteligente de sintomas e sinais',
        'Sugest√µes de diagn√≥sticos baseadas em evid√™ncias',
        'Identifica√ß√£o de padr√µes em exames laboratoriais',
        'Alertas para intera√ß√µes medicamentosas',
        'Suporte √† decis√£o cl√≠nica baseado em guidelines',
        'Aprendizado cont√≠nuo com casos similares'
      ],
      color: 'pink',
      example: 'Exemplo: Voc√™ digita os sintomas do paciente. A IA sugere poss√≠veis diagn√≥sticos com base em evid√™ncias, alerta sobre intera√ß√µes medicamentosas e mostra casos similares j√° tratados na sua cl√≠nica.'
    },
    {
      icon: 'M12 18h.01M8 21h8a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2z',
      title: 'Mobile & Cloud',
      description: 'Acesso em qualquer lugar via web ou mobile',
      fullDescription: 'Acesse seu sistema de qualquer lugar, a qualquer hora. Vers√£o mobile otimizada, sincroniza√ß√£o em tempo real entre dispositivos e backup autom√°tico na nuvem. Sua cl√≠nica sempre com voc√™, no consult√≥rio, em casa ou em viagem.',
      benefits: [
        'Aplicativo mobile nativo para iOS e Android',
        'Sincroniza√ß√£o em tempo real entre dispositivos',
        'Backup autom√°tico na nuvem',
        'Acesso offline com sincroniza√ß√£o autom√°tica',
        'Notifica√ß√µes push no celular',
        'Interface responsiva para tablets'
      ],
      color: 'cyan',
      example: 'Exemplo: Voc√™ est√° em casa e precisa verificar um agendamento urgente. Abre o app no celular, acessa todas as informa√ß√µes, faz altera√ß√µes e tudo sincroniza automaticamente com o sistema principal.'
    }
  ];
  
  let selectedFeature = 0;
  
  $: currentFeature = features[selectedFeature];
  $: gradientClass = currentFeature?.color === 'blue' ? 'from-blue-500 to-blue-600' : 
    currentFeature?.color === 'purple' ? 'from-purple-500 to-purple-600' : 
    currentFeature?.color === 'indigo' ? 'from-indigo-500 to-indigo-600' : 
    currentFeature?.color === 'green' ? 'from-green-500 to-green-600' : 
    currentFeature?.color === 'pink' ? 'from-pink-500 to-pink-600' : 
    'from-cyan-500 to-cyan-600';
  $: iconColorClass = currentFeature?.color === 'blue' ? 'text-blue-600' : 
    currentFeature?.color === 'purple' ? 'text-purple-600' : 
    currentFeature?.color === 'indigo' ? 'text-indigo-600' : 
    currentFeature?.color === 'green' ? 'text-green-600' : 
    currentFeature?.color === 'pink' ? 'text-pink-600' : 
    'text-cyan-600';
  
  function selectFeature(index) {
    selectedFeature = index;
  }
  
  function nextFeature() {
    selectedFeature = (selectedFeature + 1) % features.length;
  }
  
  function prevFeature() {
    selectedFeature = (selectedFeature - 1 + features.length) % features.length;
  }
  
  function handleKeydown(e) {
    if (!isOpen) return;
    if (e.key === 'Escape') close();
    if (e.key === 'ArrowRight') nextFeature();
    if (e.key === 'ArrowLeft') prevFeature();
  }
  
  onMount(() => {
    return () => {
      if (typeof document !== 'undefined') {
        document.body.style.overflow = '';
      }
    };
  });
</script>

<svelte:window on:keydown={handleKeydown} />

{#if isOpen}
  <div 
    class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in overflow-y-auto"
    role="dialog"
    aria-modal="true"
    aria-label="Demonstra√ß√£o de Funcionalidades"
    on:click={close}
    on:keydown={(e) => e.key === 'Escape' && close()}
  >
    <div 
      class="max-w-6xl w-full bg-white rounded-2xl shadow-2xl overflow-hidden transform scale-95 animate-scale-in my-8"
      on:click|stopPropagation
      role="document"
    >
      {#if currentFeature}
        <!-- Header -->
        <div class="bg-gradient-to-br {gradientClass} p-8 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-10">
          <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full -mr-32 -mt-32"></div>
          <div class="absolute bottom-0 left-0 w-48 h-48 bg-white rounded-full -ml-24 -mb-24"></div>
        </div>
        
        <div class="relative z-10">
          <div class="flex items-start justify-between mb-6">
            <div>
              <h2 class="text-4xl font-bold mb-2">Conhe√ßa o UpClinic</h2>
              <p class="text-white/90 text-lg">Sistema completo de gest√£o m√©dica</p>
            </div>
            <button 
              type="button"
              class="w-10 h-10 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center text-white hover:bg-white/30 transition-colors"
              on:click={close}
              aria-label="Fechar"
            >
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
          
          <!-- Feature Selector -->
          <div class="flex gap-2 flex-wrap">
            {#each features as f, index}
              <button
                type="button"
                class="px-4 py-2 rounded-lg text-sm font-medium transition-all {index === selectedFeature ? 'bg-white text-gray-900' : 'bg-white/20 text-white hover:bg-white/30'}"
                on:click={() => selectFeature(index)}
              >
                {f.title}
              </button>
            {/each}
          </div>
        </div>
      </div>
      
      <!-- Content -->
      <div class="p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <!-- Main Content -->
          <div class="lg:col-span-2">
            <div class="flex items-center gap-4 mb-6">
              <div class="w-16 h-16 bg-gradient-to-br {gradientClass} rounded-2xl flex items-center justify-center">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d={currentFeature.icon} />
                </svg>
              </div>
              <div>
                <h3 class="text-3xl font-bold text-gray-900 mb-2">{currentFeature.title}</h3>
                <p class="text-gray-600 text-lg">{currentFeature.description}</p>
              </div>
            </div>
            
            <div class="prose max-w-none mb-6">
              <p class="text-gray-700 text-lg leading-relaxed mb-6">
                {currentFeature.fullDescription}
              </p>
              
              <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-lg mb-6">
                <p class="text-gray-800 font-medium mb-2">üí° Exemplo Pr√°tico:</p>
                <p class="text-gray-700">{currentFeature.example}</p>
              </div>
            </div>
            
            <div>
              <h4 class="text-xl font-bold text-gray-900 mb-4">Principais Benef√≠cios:</h4>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {#each currentFeature.benefits as benefit}
                  <div class="flex items-start gap-3 p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors">
                    <svg class="w-6 h-6 {iconColorClass} flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span class="text-gray-700">{benefit}</span>
                  </div>
                {/each}
              </div>
            </div>
          </div>
          
          <!-- Sidebar -->
          <div class="lg:col-span-1">
            <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-6 sticky top-8">
              <h4 class="text-xl font-bold text-gray-900 mb-4">Quer ver na pr√°tica?</h4>
              <p class="text-gray-600 mb-6">
                Agende uma demonstra√ß√£o personalizada e veja como o UpClinic pode transformar a gest√£o da sua cl√≠nica.
              </p>
              
              <div class="space-y-3">
                <a 
                  href="https://wa.me/5562996720296?text=Ol√°!%20Gostaria%20de%20agendar%20uma%20demonstra√ß√£o%20do%20UpClinic"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="block w-full btn bg-green-500 hover:bg-green-600 text-white text-center"
                >
                  üì± WhatsApp
                </a>
                <a 
                  href="/contato"
                  class="block w-full btn btn-outline border-blue-600 text-blue-600 hover:bg-blue-50 text-center"
                >
                  üìß Email
                </a>
                <a 
                  href="https://upclinic-aa025.web.app/signup"
                  class="block w-full btn bg-blue-600 hover:bg-blue-700 text-white text-center"
                >
                  üöÄ Teste Gr√°tis
                </a>
              </div>
              
              <div class="mt-6 pt-6 border-t border-gray-200">
                <p class="text-sm text-gray-600 mb-2">Navegue pelas funcionalidades:</p>
                <div class="flex items-center justify-between">
                  <button
                    type="button"
                    class="p-2 rounded-lg hover:bg-gray-200 transition-colors"
                    on:click={prevFeature}
                    aria-label="Funcionalidade anterior"
                  >
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg>
                  </button>
                  <span class="text-sm text-gray-600">
                    {selectedFeature + 1} de {features.length}
                  </span>
                  <button
                    type="button"
                    class="p-2 rounded-lg hover:bg-gray-200 transition-colors"
                    on:click={nextFeature}
                    aria-label="Pr√≥xima funcionalidade"
                  >
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      {/if}
    </div>
  </div>
{/if}

<style>
  @keyframes fade-in {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  @keyframes scale-in {
    from {
      transform: scale(0.95);
      opacity: 0;
    }
    to {
      transform: scale(1);
      opacity: 1;
    }
  }
  
  .animate-fade-in {
    animation: fade-in 0.3s ease-out;
  }
  
  .animate-scale-in {
    animation: scale-in 0.3s ease-out;
  }
</style>

